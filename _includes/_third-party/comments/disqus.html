{% if site.disqus.enable %}
<link rel="stylesheet" href="http://disqus.jqian.net/dist/iDisqus.min.css" />
<script src="http://disqus.jqian.net/dist/iDisqus.min.js"></script>

{% comment %}
Reference:
- disqus-php-api @github
- _include/_partials/comments.html
{% endcomment %}

<!-- <div id="comment" class="comments"></div> -->
<!-- <ul id="popular-posts"></ul> -->
<script>
var disq = new iDisqus('disqus_comment', {
    forum: 'jqian',
    site: 'http://blog.jqian.net',
    api: 'http://disqus.jqian.net/api',
    url: '{{ page.url | relative_url }}',
    mode: 1,
    timeout: 3000,
//    popular: document.getElementById('popular-posts'),
    init: true,
});
// disq.popular();
disq.count();
</script>
{% endif %}


{% comment %} disqus is blocked by gfw {% endcomment %}
  {% if false %}

    {% if site.disqus.count %}
      <script id="dsq-count-scr" src="https://{{site.disqus.shortname}}.disqus.com/count.js" async></script>
    {% endif %}

    {% if page.comments %}
      {% if site.disqus.hide %}
      <script type="text/javascript">
          (function () {
              // ECMSScript 5 Strict Mode
              'use strict';

              // Global object
              var App = {};

              // Create button
              App.commentsButton = document.createElement('button');
              App.commentsButton.setAttribute('class', 'comments-button');
              App.commentsButton.setAttribute('data-js', 'comments-button');
              App.commentsButton.innerHTML = 'Show Comments';

              // Append button to body
              parent.document.getElementById("post-nav-id").firstElementChild.appendChild(App.commentsButton);

              // Click event handler
              App.commentsButton.onclick = function () {

                  // Remove button on click
                  this.parentNode.removeChild(this);

                  // Create comments container
                  App.disqusContainer = document.createElement('div');
                  App.disqusContainer.setAttribute('id', 'disqus_thread');

                  // Append container to body
                  document.body.appendChild( App.disqusContainer );

                  var disqus_config = function () {
                      this.page.url = '{{ page.url | absolute_url }}';
                      this.page.identifier = '{{ page.url | relative_url }}';
                      this.page.title = '{{ page.title| replace: "'", "\\'" }}';
                  };
                  var d = document, s = d.createElement('script');
                  s.src = 'https://{{site.disqus.shortname}}.disqus.com/embed.js';
                  s.setAttribute('data-timestamp', '' + +new Date());
                  (d.head || d.body).appendChild(s);
              };
          })();
      </script>
      {% else %}
      <script type="text/javascript">
          var disqus_config = function () {
              this.page.url = '{{ page.url | absolute_url }}';
              this.page.identifier = '{{ page.url | relative_url }}';
              this.page.title = '{{ page.title| replace: "'", "\\'" }}';
          };
          var d = document, s = d.createElement('script');
          s.src = 'https://{{site.disqus.shortname}}.disqus.com/embed.js';
          s.setAttribute('data-timestamp', '' + +new Date());
          (d.head || d.body).appendChild(s);
      </script>
      {% endif %}
    {% endif %}
{% endif %}
